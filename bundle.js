!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t){"use strict";t("setimmediate");var e=t("./CanvasController");document.addEventListener("DOMContentLoaded",function(){var t=new e;document.body.appendChild(t.element)})},{"./CanvasController":5,setimmediate:3}],2:[function(t,e){function n(){if(!s){s=!0;for(var t,e=o.length;e;){t=o,o=[];for(var n=-1;++n<e;)t[n]();e=o.length}s=!1}}function r(){}var i=e.exports={},o=[],s=!1;i.nextTick=function(t){o.push(t),s||setTimeout(n,0)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=r,i.addListener=r,i.once=r,i.off=r,i.removeListener=r,i.removeAllListeners=r,i.emit=r,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],3:[function(t){(function(t){!function(e,n){"use strict";function r(t){return l[m]=i.apply(n,t),m++}function i(t){var e=[].slice.call(arguments,1);return function(){"function"==typeof t?t.apply(n,e):new Function(""+t)()}}function o(t){if(g)setTimeout(i(o,t),0);else{var e=l[t];if(e){g=!0;try{e()}finally{s(t),g=!1}}}}function s(t){delete l[t]}function a(){d=function(){var e=r(arguments);return t.nextTick(i(o,e)),e}}function h(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function u(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&o(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),d=function(){var n=r(arguments);return e.postMessage(t+n,"*"),n}}function c(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;o(e)},d=function(){var e=r(arguments);return t.port2.postMessage(e),e}}function p(){var t=v.documentElement;d=function(){var e=r(arguments),n=v.createElement("script");return n.onreadystatechange=function(){o(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n),e}}function f(){d=function(){var t=r(arguments);return setTimeout(i(o,t),0),t}}if(!e.setImmediate){var d,m=1,l={},g=!1,v=e.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(e);y=y&&y.setTimeout?y:e,"[object process]"==={}.toString.call(e.process)?a():h()?u():e.MessageChannel?c():v&&"onreadystatechange"in v.createElement("script")?p():f(),y.setImmediate=d,y.clearImmediate=s}}(new Function("return this")())}).call(this,t("_process"))},{_process:2}],4:[function(t,e){"use strict";var n=function(){function t(t){this.color=t}return Object.defineProperty(t.prototype,"isOpaque",{get:function(){return 0!==this.color.a},enumerable:!0,configurable:!0}),t}();e.exports=n},{}],5:[function(t,e){"use strict";function n(t){return new o(t.clientX,t.clientY)}var r,i=t("./Renderer"),o=t("./Point"),s=t("./Color"),a=t("./Transform"),h=t("./Background");!function(t){t[t.None=0]="None",t[t.Pressed=1]="Pressed",t[t.Pinching=2]="Pinching"}(r||(r={}));var u=function(){function t(){this.interactionState=0,this.transform=a.identity(),this.initialTransform=a.identity(),this.isStroking=!1,this.strokeWidth=2,this.strokeColor=new s(0,0,0,1),this.renderer=new i({background:new h(new s(255,255,255,1))});var t=this.element=document.createElement("div");t.className="canvas-area",t.appendChild(this.renderer.element),t.addEventListener("mousemove",this.onMouseMove.bind(this)),t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("touchmove",this.onTouchMove.bind(this)),t.addEventListener("touchstart",this.onTouchStart.bind(this)),t.addEventListener("touchend",this.onTouchEnd.bind(this)),t.addEventListener("wheel",this.onWheel.bind(this))}return t.prototype.pinchStart=function(t){this.interactionState=2,this.pinchStartPoints=t,this.initialTransform=this.transform},t.prototype.pinchMove=function(t){2!==this.interactionState&&this.pinchStart(t);var e=t[0].sub(t[1]).length/this.pinchStartPoints[0].sub(this.pinchStartPoints[1]).length,n=this.pinchStartPoints[0].add(this.pinchStartPoints[1]).mul(.5),r=t[0].add(t[1]).mul(.5),i=r.sub(n.mul(e)),o=a.scale(e,e).merge(a.translation(i)),o=this.initialTransform.merge(o);this.updateTransform(o),this.renderer.update()},t.prototype.pinchEnd=function(){this.interactionState=0},t.prototype.pressStart=function(t){this.interactionState=1,t=t.transform(this.transform.invert());var e=this.currentStroke=this.renderer.newStroke();e.width=this.strokeWidth,e.color=this.strokeColor,e.addPoint(t),this.renderer.addStroke(e),this.renderer.update(!0)},t.prototype.pressMove=function(t){1===this.interactionState&&(t=t.transform(this.transform.invert()),this.currentStroke.addPoint(t),this.renderer.update(!0))},t.prototype.pressEnd=function(){1===this.interactionState&&(this.interactionState=0)},t.prototype.updateTransform=function(t){this.transform=t,this.renderer.transform=t},t.prototype.onMouseMove=function(t){this.pressMove(new o(t.clientX,t.clientY))},t.prototype.onMouseDown=function(t){this.pressStart(new o(t.clientX,t.clientY))},t.prototype.onMouseUp=function(){this.pressEnd()},t.prototype.onTouchMove=function(t){if(1===t.touches.length){var e=t.touches[0];this.pressMove(n(e))}else 2===t.touches.length&&this.pinchMove([0,1].map(function(e){return n(t.touches[e])}));t.preventDefault()},t.prototype.onTouchStart=function(t){if(1===t.touches.length){var e=t.touches[0];this.pressStart(n(e))}else 2===t.touches.length&&this.pinchStart([0,1].map(function(e){return n(t.touches[e])}));t.preventDefault()},t.prototype.onTouchEnd=function(t){this.pressEnd(),this.pinchEnd(),t.preventDefault()},t.prototype.onWheel=function(t){var e=this.transform.translate(new o(-t.deltaX,-t.deltaY));this.updateTransform(e),this.renderer.update(),t.preventDefault()},t}();e.exports=u},{"./Background":4,"./Color":6,"./Point":8,"./Renderer":9,"./Transform":11}],6:[function(t,e){"use strict";var n=function(){function t(t,e,n,r){this.r=t,this.g=e,this.b=n,this.a=r}return t.prototype.toString=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.a+")"},t.prototype.toData=function(){return new Float32Array([this.r,this.g,this.b,this.a])},t}();e.exports=n},{}],7:[function(t,e){"use strict";var n=this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},r=t("./shader"),i=function(t){function e(e){var n="\n      uniform mat3 uViewportTransform;\n      uniform mat3 uSceneTransform;\n      attribute vec2 aPosition;\n      void main(void) {\n        vec3 pos = uViewportTransform * uSceneTransform * vec3(aPosition, 1.0);\n        gl_Position = vec4(pos.xy, 0.0, 1.0);\n      }\n    ",r="\n      precision mediump float;\n      uniform vec4 uColor;\n      void main(void) {\n        gl_FragColor = uColor;\n      }\n    ";t.call(this,e,n,r),this.aPosition=e.getAttribLocation(this.program,"aPosition"),this.uViewportTransform=e.getUniformLocation(this.program,"uViewportTransform"),this.uSceneTransform=e.getUniformLocation(this.program,"uSceneTransform"),this.uColor=e.getUniformLocation(this.program,"uColor"),e.enableVertexAttribArray(this.aPosition)}return n(e,t),e.prototype.setColor=function(t){this.gl.uniform4fv(this.uColor,t.toData())},e.prototype.setViewportTransform=function(t){this.gl.uniformMatrix3fv(this.uViewportTransform,!1,t.toData())},e.prototype.setSceneTransform=function(t){this.gl.uniformMatrix3fv(this.uSceneTransform,!1,t.toData())},e}(r);e.exports=i},{"./shader":12}],8:[function(t,e){"use strict";var n=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e,this.y*e)},t.prototype.div=function(e){return new t(this.x/e,this.y/e)},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.rotate90=function(){return new t(-this.y,this.x)},t.prototype.normalize=function(){return this.div(this.length)},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.ceil=function(){return new t(Math.ceil(this.x),Math.ceil(this.y))},t.prototype.transform=function(e){var n=e.m11*this.x+e.m21*this.y+e.dx,r=e.m12*this.x+e.m22*this.y+e.dy;return new t(n,r)},t.prototype.toString=function(){return"Point("+this.x+","+this.y+")"},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t}();e.exports=n},{}],9:[function(t,e){"use strict";var n=t("./Point"),r=t("./Transform"),i=t("./Stroke"),o=t("./FillShader"),s=function(){function t(t){this.element=document.createElement("canvas"),this.strokes=[],this.isUpdateQueued=!1,this.devicePixelRatio=1,this.width=0,this.height=0,this.transform=r.identity();var e=this.gl=this.element.getContext("webgl",{alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!0});this.shader=new o(e),this.background=t.background;var n=this.background.color;e.clearColor(n.r,n.g,n.b,n.a),this.element.className="canvas-area__renderer",window.addEventListener("resize",this.onResize.bind(this)),this.onResize()}return t.prototype.addStroke=function(t){this.strokes.push(t)},t.prototype.newStroke=function(){return new i(this.gl)},t.prototype.update=function(t){var e=this;if(void 0===t&&(t=!1),!this.isUpdateQueued){this.isUpdateQueued=!0;var n=function(){e.render(),e.isUpdateQueued=!1};t?setImmediate(n):requestAnimationFrame(n)}},t.prototype.render=function(){var t=this,e=this.gl,n=this.shader;e.clear(e.COLOR_BUFFER_BIT),n.use(),n.setViewportTransform(this.viewportTransform),n.setSceneTransform(this.transform),this.strokes.forEach(function(r){n.setColor(r.color),e.bindBuffer(e.ARRAY_BUFFER,r.buffer),e.vertexAttribPointer(t.shader.aPosition,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,r.polygon.length)})},t.prototype.onResize=function(){var t=this.width=window.innerWidth,e=this.height=window.innerHeight,i=this.devicePixelRatio=window.devicePixelRatio||1;this.viewportTransform=r.scale(2/t,2/e).translate(new n(-1,-1)).scale(1,-1),this.element.width=t*i,this.element.height=e*i,this.gl.viewport(0,0,t*i,e*i),console.log("resized to "+t+" * "+e+", pixel ratio "+devicePixelRatio),this.update()},t}();e.exports=s},{"./FillShader":7,"./Point":8,"./Stroke":10,"./Transform":11}],10:[function(t,e){"use strict";var n=t("./Color"),r=function(){function t(t){this.points=[],this.color=new n(0,0,0,1),this.width=1,this.type="pen",this.polygon=[],this.gl=t,this.buffer=t.createBuffer()}return t.prototype.addPoint=function(t){if(this.points.push(t),this.points.length>=2){var e=this.points[this.points.length-2],n=t.sub(e).normalize().rotate90(),r=n.mul(this.width/2),i=n.mul(-this.width/2);this.polygon.push(e.add(r)),this.polygon.push(e.add(i)),this.polygon.push(t.add(r)),this.polygon.push(t.add(i))}this._updatePolygon()},t.prototype._updatePolygon=function(){var t=new Float32Array(2*this.polygon.length);this.polygon.forEach(function(e,n){t[2*n]=e.x,t[2*n+1]=e.y});var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW)},t}();e.exports=r},{"./Color":6}],11:[function(t,e){"use strict";var n=function(){function t(t,e,n,r,i,o){this.m11=t,this.m12=e,this.m21=n,this.m22=r,this.dx=i,this.dy=o}return t.prototype.merge=function(e){var n=e.m11*this.m11+e.m21*this.m12,r=e.m11*this.m21+e.m21*this.m22,i=e.m12*this.m11+e.m22*this.m12,o=e.m12*this.m21+e.m22*this.m22,s=e.m11*this.dx+e.m21*this.dy+e.dx,a=e.m12*this.dx+e.m22*this.dy+e.dy;return new t(n,r,i,o,s,a)},t.prototype.invert=function(){var e=this.m11*this.m22-this.m12*this.m21,n=this.m22/e,r=-this.m12/e,i=-this.m21/e,o=this.m11/e,s=-(n*this.dx+i*this.dy),a=-(r*this.dx+o*this.dy);return new t(n,r,i,o,s,a)},t.prototype.translate=function(e){return new t(this.m11,this.m12,this.m21,this.m22,this.dx+e.x,this.dy+e.y)},t.prototype.scale=function(e,n){return new t(this.m11*e,this.m12*e,this.m21*n,this.m22*n,this.dx*e,this.dy*n)},t.prototype.toData=function(){return new Float32Array([this.m11,this.m12,0,this.m21,this.m22,0,this.dx,this.dy,1])},t.identity=function(){return new t(1,0,0,1,0,0)},t.scale=function(e,n){return new t(e,0,0,n,0,0)},t.translation=function(e){return new t(1,0,0,1,e.x,e.y)},t}();e.exports=n},{}],12:[function(t,e){"use strict";var n=function(){function t(t,e,n){this.gl=t,this._setup(e,n)}return t.prototype.use=function(){this.gl.useProgram(this.program)},t.prototype._compile=function(t,e){var n=this.gl,r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(console.warn("An error occurred compiling the shaders"),console.warn(n.getShaderInfoLog(r)),null)},t.prototype._setup=function(t,e){var n=this.gl,r=this.program=n.createProgram();n.attachShader(r,this._compile(t,n.VERTEX_SHADER)),n.attachShader(r,this._compile(e,n.FRAGMENT_SHADER)),n.linkProgram(r),n.getProgramParameter(r,n.LINK_STATUS)||console.warn("Failed to link shader program"),n.useProgram(r)},t}();e.exports=n},{}]},{},[1]);
//# sourceMappingURL=bundle.js.map