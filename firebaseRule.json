{
  "rules": {
    ".read": true,
    ".write": false,
    "shapes": {
      "$canvas_id": {
        ".validate": "newData.hasChildren(['user_id', 'type', 'brush', 'fragments'])",
        "type": { ".validate": "newData.val() === 'stroke'" },
        "user_id": { ".validate": "root.child('users').hasChild(newData.val())" },
        "brush": {
          ".validate": "newData.hasChildren(['color', 'width'])",
          "color": { ".validate": "newData.isString()" },
          "width": { ".validate": "newData.isNumber()" }
        },
        "fragments": {
          "$id": {
            ".validate": "newData.isString()"
          }
        },
        ".write": "auth != null && root.child('collaborations').child($canvas_id).child(auth.uid).val() == true"
      }
    }
  }
}
